# Memcomparable format

- Memcomparable format には、エンコード後のバイト列を連結してもソート順が保たれる性質がある
- 参考: https://github.com/facebook/mysql-5.6/wiki/MyRocks-record-format#memcomparable-format

## エンコードの流れ

_前提_

- エンコード形式: `[8 バイトのデータ][1 バイトの長さ情報]` のブロックを繰り返す

_手順_

以下の手順を、8 バイトずつ、指定されたデータのサイズが 0 になるまで繰り返す

#### 1. コピーサイズを計算する

#### 2. データをコピーする

#### 3. 長さ情報を追加

- この際、データが 8 バイトに満たない場合は、0 で埋める (e.g. `[データ][0 パディング][長さ情報]`)

### 例

_5 バイトのデータをエンコードする場合_

- 入力: [A, B, C, D, E]
- 処理の流れ:
   1. コピーサイズを計算: 5 バイト
   2. データをコピー: [A, B, C, D, E]
   3. 長さ情報を追加 (8 バイトに満たないのでパディングを追加): [A, B, C, D, E, 0, 0, 0, 5]

_10 バイトのデータをエンコードする場合_

- 入力: [A, B, C, D, E, F, G, H, I, J]
- 処理の流れ:
   1. コピーサイズを計算: 8 バイト
   2. データをコピー: [A, B, C, D, E, F, G, H]
   3. 長さ情報を追加: [A, B, C, D, E, F, G, H, 9]
   4. 残りのデータ (I, J) に対して同様の手順を繰り返す
   5. コピーサイズを計算: 2 バイト
   6. データをコピー: [I, J]
   7. 長さ情報を追加 (8 バイトに満たないのでパディングを追加): [I, J, 0, 0, 0, 0, 0, 0, 2]
